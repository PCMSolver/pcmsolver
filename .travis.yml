language: cpp
git:
  submodules: false
branches:
  only:
    - release
before_install:
  - sudo apt-get -qq update
  - sudo apt-get install gfortran gfortran-multilib 
  - sudo pip install cpp-coveralls
install: true
before_script:
  - export FC=gfortran
script:                                                                 
      - python setup --cxx=g++ --cc=gcc --fc=gfortran --type=debug --tests --coverage
      - cd build
      - make
      - make test
after_success:
  - coveralls --root .. -E ".*external.*" -E ".*CMakeFiles.*" -E ".*generated.*" -E ".*tests*" -E ".*tools.*"
notifications:
  recipients:
    - roberto.d.remigio@uit.no
    - luca.frediani@uit.no
  email:
    on_success: change
    on_failure: always
addons:
  coverity_scan:
    project:
      name: "PCMSolver/pcmsolver"
      description: "Build submitted via Travis CI"
    notification_email: roberto.d.remigio@uit.no
    build_command_prepend: "python setup --cxx=g++ --cc=gcc --fc=gfortran --type=debug --tests --coverage; cd build"
    build_command:   "make"
    branch_pattern: release
